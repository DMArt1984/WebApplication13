@model UserInfo
@{
    ViewData["Title"] = "Профиль пользователя";
    var company = Model.User.getListClaim(Model.Claims, "company").Where(x => x != "").Distinct();
    var job = Model.User.getListClaim(Model.Claims, "job").Where(x => x != "").Distinct();
    var roles = Model.Roles.Where(x => x != "").Distinct();
    var checkE = (Model.Edit.ConfirmEmail) ? "d-none" : "";
    var checkP = (Model.Edit.ConfirmPhone) ? "d-none" : "";
    var viewSuperAdmin = (!ViewContext.HttpContext.User.IsInRole("SuperAdmin")) ? "d-none" : "";
    var viewPhoto = (Model.User.Photo == null) ? "none" : "";

    <!--- Claims -->
    var MyClaims = Model.Claims.ToList();
    MyClaims.RemoveAll(x => x.Type.ToLower() == "company");
    MyClaims.RemoveAll(x => x.Type.ToLower() == "job");
}

<style>
    .container {
        position: relative;
        width: 100%;
        max-width: 400px;
    }

        .container .mybg {
            opacity: 0.5;
            background-color: black;
            width: 100%;
            height: 90px;
            position: absolute;
            color: white;
            padding: 4px 8px;
            border: none;
            border-radius: 5px;
            bottom: 0%;
        }

        .container img {
            width: 100%;
            height: auto;
        }

        .container .photobtn {
            position: absolute;
            color: white;
            font-size: 16px;
            padding: 4px 8px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            text-align: center;
        }

        .container .pfile {
            background-color: #0bb197;
            bottom: 2%;
            left: 4%;
        }

        .container .pdel {
            background-color: #ff3d60;
            bottom: 2%;
            right: 4%;
        }

        .container .pfile:hover {
            background-color: black;
        }

        .container .pdel:hover {
            background-color: black;
        }
</style>

<!--<button type="button" class="btn btn-danger waves-effect waves-light" data-bs-toggle="modal" onclick="ShowId('myModal_1');" data-bs-target="#myModal_1">Удалить</button>-->
<!-- sample modal content -->
<div id="myModal_Delete" class="modal fade show" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-modal="true" style="display: block;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="myModalLabel">Удалить пользователя @Model.User.Email ?</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>После этого действия вы не сможете востановить его профиль</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary waves-effect" data-bs-dismiss="modal">Отмена</button>
                <a class="btn btn-danger waves-effect" asp-action="RemoveUser" asp-route-Id="@Model.User.Id">Удалить</a>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<!-- Nav tabs -->
<ul class="nav nav-tabs mx-3" role="tablist">
    <li class="nav-item">
        <a id="tab1" class="nav-link active" data-bs-toggle="tab" href="#view-profile" role="tab" aria-selected="true">
            <i class="fas fa-address-card me-1 align-middle"></i> <span class="d-none d-md-inline-block">Просмотр</span>
        </a>
    </li>
    <li class="nav-item">
        <a id="tab2" class="nav-link" data-bs-toggle="tab" href="#edit-profile" role="tab" aria-selected="false">
            <i class="fas fa-edit me-1 align-middle"></i> <span class="d-none d-md-inline-block">Pедактирование</span>
        </a>
    </li>
</ul>

<!-- Tab panes -->
<div class="tab-content pt-0">
    <!-- 1: View -->
    <div class="tab-pane active" id="view-profile" role="tabpanel">
        <div class="card">
            <div class="card-body">
                <div class="row g-0 d-flex justify-content-between">

                    <!-- 1 col -->
                    <div class="col-sm-10 col-md mx-2">
                        <p class="mb-0">
                            @if (Model.User.Photo != null)
                            {
                                <img id="profilePicture" class="card-img img-fluid" style="width:300px; object-fit:cover" src="data:image/*;base64,@(Convert.ToBase64String(Model.User.Photo))">
                            }
                            else
                            {
                                <h4 class="p-4 text-center"><span class="badge badge-soft-danger">Нет фото</span></h4>
                            }
                        </p>
                        <hr class="d-md-none mt-3" />
                    </div>

                    <!-- 2 col -->
                    <div class="col-sm-10 col-md mx-2">
                        <!-- ID -->
                        <div class="@viewSuperAdmin">
                            <small>ID: </small>
                            <h5>@Model.User.Id</h5>
                            <hr />
                        </div>
                        <!-- почта -->
                        <small>Email: </small>
                        <h5 id="email" class="card-title">
                            <a href="mailto:@Model.User.Email">
                                @Model.User.Email
                            </a>
                            @if (Model.User.EmailConfirmed == false)
                            {
                                <span class="badge bg-danger"> не подтверждено</span>
                            }
                        </h5>

                        <!-- полное имя (ФИО) -->
                        @if (!String.IsNullOrWhiteSpace(Model.User.FullName))
                        {
                            <hr />
                            <small>ФИО: </small>
                            <h5 id="fullname">@Model.User.FullName</h5>
                        }

                        <!-- роли -->
                        @if (roles.Count() > 1)
                        {
                            <hr />
                            <small>Роли: </small>
                            <h6 id="roles">
                                @{
                                    foreach (var role in roles)
                                    {
                                        var rusname = Model.User.getRoleName(@role);
                                        switch (role.ToLower())
                                        {
                                            case "superadmin":
                                                <span class="badge bg-dark">@rusname</span>
                                                break;
                                            case "admin":
                                                <span class="badge bg-info">@rusname</span>
                                                break;
                                            case "moderator":
                                                <span class="badge bg-soft-primary text-primary">@rusname</span>
                                                break;
                                            default:
                                                <span class="badge bg-light">@rusname</span>
                                                break;
                                        }

                                    }
                                }
                            </h6>
                        }

                        <hr class="d-md-none" />
                    </div>

                    <!-- 3 col -->
                    <div class="col-sm-10 col-md mx-2">
                        <!-- компания -->
                        <div class="@viewSuperAdmin">
                            <small>Компания: </small>
                            <h5 id="company">@String.Join(',', company)</h5>
                            <hr />
                        </div>
                        <!-- телефон -->
                        @if (!String.IsNullOrWhiteSpace(Model.User.PhoneNumber))
                        {
                            <small>Номер телефона: </small>
                            <h5 id="phone" class="card-title">
                                <a href="tel:@Model.User.PhoneNumber">
                                    @Model.User.PhoneNumber
                                </a>
                                @if (Model.User.PhoneNumber != null && Model.User.PhoneNumberConfirmed == false)
                                {
                                    <!--<span class="badge bg-danger"> не подтверждено</span>-->
                                }
                            </h5>
                        }
                        <!-- должность -->
                        @if (job.Count() >= 1)
                        {
                            <hr />
                            <small>Должность: </small>
                            <h5 id="job">
                                @String.Join(',', job)
                            </h5>
                        }
                    </div>

                    <!-- 4 col -->
                    @if (MyClaims.Count() > 0)
                    {
                        <div class="col-sm-10 col-md mx-2">
                            <hr class="d-md-none mt-3" />
                            <ul class="card-text">
                                @foreach (var cl in MyClaims)
                                {
                                    <li><small>@cl.Type =</small> @cl.Value</li>
                                }
                            </ul>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
    <!-- 2: Edit -->
    <div class="tab-pane" id="edit-profile" role="tabpanel">
        <form asp-action="Profile" method="post" enctype="multipart/form-data">
            <div class="card">
                <div class="card-body">
                    <div asp-validation-summary="All" class="text-danger"></div>
                    <div class="row g-0 d-flex justify-content-between">
                        <!-- 1 col -->
                        <div class="col-md-3 mx-2">
                            <p class="mb-0">
                                <div class="container">
                                    <div id="backgphoto" class="mybg"></div>
                                    @if (Model.User.Photo != null)
                                    {
                                        <img id="profilePictureE" class="card-img img-fluid" style="object-fit:cover" src="data:image/*;base64,@(Convert.ToBase64String(Model.User.Photo))">
                                    }
                                    else
                                    {
                                        <img id="profilePictureE" class="card-img img-fluid" style="object-fit:cover" src="">
                                    }
                                    <!-- change file -->
                                    <label id="newphoto" for="inputTag" style="cursor: pointer" class="text-center photobtn pfile">
                                        <small>Выбрать</small><br />
                                        <i class="fa fa-2x fa-camera"></i>
                                        <input class="d-none" id="inputTag" type="file" asp-for="Edit.Avatar"
                                               onchange="document.getElementById('profilePictureE').src = window.URL.createObjectURL(this.files[0]); document.getElementById('imageName').innerText = this.files[0].name; PhotoShow();" />
                                    </label>

                                    <!-- delete -->
                                    <label id="del_photo" for="delTag" style="cursor: pointer; display:@viewPhoto" class="text-center photobtn pdel">
                                        <small>Удалить</small><br />
                                        <i class="fas fa-2x fa-window-close"></i>
                                        <input class="d-none" id="delTag" asp-for="Edit.RemoveAvatar"
                                               onchange="PhotoHide();" />
                                    </label>
                                </div>

                                <span asp-validation-for="Edit.Avatar" class="text-danger"></span>
                                <div class="d-flex justify-content-around p-0 m-1">
                                    <!--style="text-align:center; padding:3%;"-->
                                    <!--border:thin solid black-->
                                    <span id="imageName" style="color: green"></span>
                                    <!--
                                        <label id="del_photo" class="checkbox align-middle viewPhoto" style="" asp-for="Edit.RemoveAvatar">
                                            <input asp-for="Edit.RemoveAvatar" class="form-check-input" />
                                            Удалить
                                        </label>
                                    -->
                                </div>
                            </p>
                        </div>

                        <hr class="d-md-none mt-3" />
                        <!-- 2 col -->
                        <div class="col-md-4 mx-2">
                            <!-- ID -->
                            <div class="form-group mb-3 @viewSuperAdmin">
                                <small>ID: </small>
                                <input asp-for="User.Id" class="form-control" required="" readonly />
                            </div>
                            <!-- почта -->
                            <div id="e_email" class="form-group mb-3">
                                <small>Email: </small>
                                <input asp-for="Edit.Email" class="form-control" required="" />
                                <span asp-validation-for="Edit.Email" class="text-danger"></span>
                                <div class="checkbox @checkE">
                                    <label asp-for="Edit.ConfirmEmail">
                                        <input asp-for="Edit.ConfirmEmail" class="form-check-input" />
                                        Почта подтверждена
                                    </label>
                                </div>
                            </div>
                            <!-- полное имя (ФИО) -->
                            <div id="e_fullname" class="form-group mb-3">
                                <small>ФИО: </small>
                                <input asp-for="Edit.FullName" class="form-control" />
                                <span asp-validation-for="Edit.FullName" class="text-danger"></span>
                            </div>
                            <!-- роли -->
                            <div id="e_roles" class="form-group mb-3">
                                <small>Роли: </small>
                                @if (@Model.Edit.Roles == "admin")
                                {
                                    <select class="form-select" asp-for="Edit.Roles">
                                        <option selected value="admin">@Model.User.getRoleName("admin")</option>
                                        <option value="basic">@Model.User.getRoleName("basic")</option>
                                    </select>
                                }
                                else
                                {
                                    <select class="form-select" asp-for="Edit.Roles">
                                        <option value="admin">@Model.User.getRoleName("admin")</option>
                                        <option selected value="basic">@Model.User.getRoleName("basic")</option>
                                    </select>
                                }
                                <span asp-validation-for="Edit.Roles" class="text-danger"></span>
                            </div>

                        </div>
                        <!-- 3 col -->
                        <div class="col-md-4 mx-2">
                            <!-- компания -->
                            <div id="e_company" class="form-group mb-3 @viewSuperAdmin">
                                <small>Компания: </small>
                                <input asp-for="Edit.Company" class="form-control" required="" readonly />
                                <span asp-validation-for="Edit.Company" class="text-danger"></span>
                            </div>
                            <!-- телефон -->
                            <div id="e_phone" class="form-group mb-3">
                                <small>Номер телефона: </small>
                                <input asp-for="Edit.PhoneNumber" class="form-control" />
                                <span asp-validation-for="Edit.PhoneNumber" class="text-danger"></span>
                                <div class="d-none checkbox @checkP">
                                    <label asp-for="Edit.ConfirmPhone">
                                        <input asp-for="Edit.ConfirmPhone" class="form-check-input" />
                                        Телефон подтвержден
                                    </label>
                                </div>
                            </div>
                            <!-- должность -->
                            <div id="e_job" class="form-group mb-3">
                                <small>Должность: </small>
                                <input asp-for="Edit.Job" class="form-control" list="datalistOptions" id="exampleDataList" />
                                <datalist id="datalistOptions">
                                    @foreach (var item in @Model.Edit.DataListJob)
                                    {
                                        <option value="@item">
                                        </option>
                                    }
                                </datalist>
                                <span asp-validation-for="Edit.Job" class="text-danger"></span>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="row g-0 d-flex justify-content-start">
                <!-- удалить пользователя-->
                <button type="button" class="col col-sm-4 col-md-3 mx-2 mb-1 btn btn-danger btn btn-block" data-bs-toggle="modal" data-bs-target="#myModal_Delete"><i class="fas fa-trash-alt px-1"></i> Удалить</button>
                <!-- сохранить -->
                <button type="submit" class="col col-sm-4 col-md-3 mx-2 mb-1 btn btn-primary btn btn-block"><i class="fas fa-save px-1"></i> Сохранить</button>
            </div>
        </form>
    </div>
</div>






@section Scripts {

    <script type="text/javascript">
        HideId('myModal_Delete');

        // func...
        function HideId(id) {
            document.getElementById(id).style.display = 'none'; // скрыть
        }
        function ShowId(id) {
            document.getElementById(id).style.display = ''; // показать
        }

        // photo show
        function PhotoShow() {
            document.getElementById('del_photo').style.display = '';
            document.getElementById('backgphoto').style.display = '';
            document.getElementById('newphoto').style.bottom = '2%';
        }
        // photo hide
        function PhotoHide() {
            document.getElementById('profilePictureE').src = '';
            document.getElementById('imageName').innerText = '';
            document.getElementById('del_photo').style.display = 'none';
            document.getElementById('backgphoto').style.display = 'none';
            document.getElementById('newphoto').style.bottom = '-60px';
        }

    </script>

    @if (Model.EnableEditor)
    {

        @if (Model.ViewEditor)
        {
            <script type="text/javascript">
                document.getElementById('tab1').className = "nav-link";
                document.getElementById('tab2').className = "nav-link active";
                document.getElementById('view-profile').className = "tab-pane";
                document.getElementById('edit-profile').className = "tab-pane active";
            </script>
        }
    }
    else
    {
        <script type="text/javascript">
            HideId('tab2');
        </script>
    }

    @if (Model.User.Photo == null) {
        <script>PhotoHide();</script>
    }

}



